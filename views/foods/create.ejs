<div class="flex flex-col items-center min-h-[60vh] py-8">
  <div class="bg-white shadow-lg rounded-xl p-10 w-full max-w-xl">
    <h1 class="text-3xl font-bold text-indigo-700 mb-8">
      ìƒˆ ìŒì‹ ì¶”ê°€
    </h1>
    <form action="/foods/create" method="POST" enctype="multipart/form-data" class="space-y-6">
      <div>
        <label for="name" class="block text-gray-700 font-medium mb-2">ì´ë¦„</label>
        <input type="text" id="name" name="name" required class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-400 text-lg" />
      </div>
      <div>
        <label for="name" class="block text-gray-700 font-medium mb-2">ì¢…ë¥˜</label>
        <input type="text" id="type" name="type" required class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-400 text-lg" />
      </div>
      <div>
        <label for="description" class="block text-gray-700 font-medium mb-2">ì„¤ëª…</label>
        <textarea id="description" name="description" class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-400 text-lg"></textarea>
      </div>
      <div>
        <label for="expiryAt" class="block text-gray-700 font-medium mb-2">ìœ í†µê¸°í•œ</label>
        <input type="date" id="expiryAt" name="expiryAt" class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-400 text-lg" />
      </div>
      <div>
        <label for="groupId" class="block text-gray-700 font-medium mb-2">ê·¸ë£¹ ì„ íƒ</label>
        <select id="groupId" name="groupId" class="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-400 text-lg">
          <option value="nothing" selected hidden>ê·¸ë£¹ì„ ì„ íƒí•˜ì„¸ìš”</option>
          <% if (Array.isArray(groups) !== 'undefined' && groups.length > 0) { %>
          <% groups.forEach(function(group) { %>
          <option value="<%= group._id %>" <%= (typeof groupId !== 'undefined' && groupId === group._id.toString()) ? 'selected' : '' %>><%= group.name %>
          </option>
          <% }); %>
          <% } %>
        </select>
      </div>
      <div>
        <label for="image" class="block text-gray-700 font-medium mb-2">ì‚¬ì§„ ì—…ë¡œë“œ</label>
        <input type="file" id="image" name="image" accept="image/*" class="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-green-400" />
        <p id="upload-alert" class="text-sm text-gray-500 mt-1">ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
      </div>
      <div class="flex gap-4 mt-8">
        <button type="submit" class="w-full px-5 py-3 bg-green-600 text-white rounded hover:bg-green-500 font-semibold transition text-lg">
          ì¶”ê°€í•˜ê¸°
        </button>
        <button type="button" onclick="history.back()" class="w-full px-5 py-3 bg-gray-200 text-gray-700 rounded text-center hover:bg-gray-300 font-semibold transition text-lg">
          ì·¨ì†Œ
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  const imageInput = document.getElementById('image');
  const typeInput = document.getElementById('type');
  const imageAlert = document.getElementById('upload-alert');

  imageInput.addEventListener('change', async (e) => {
    if (imageInput.files && imageInput.files[0]) {
      const file = imageInput.files[0];
      const formData = new FormData();
      formData.append('image', file);

      imageAlert.innerText = "ğŸ¤– ì¸ê³µì§€ëŠ¥ì´ ë§›ë³´ëŠ” ì¤‘...";
      imageAlert.classList.add('animate-pulse');

      try {
        const response = await fetch('/foods/analyze', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        console.log(result.type);
        imageAlert.innerText = "ğŸ¤– ìŒì‹ ì¢…ë¥˜ ë¶„ì„ ì™„ë£Œ";
        imageAlert.classList.remove('animate-pulse');

        if (response.ok) {
          if (result.type) {
            typeInput.value = result.type;
          }
        } else {
          throw new Error(result.error);
        }

      } catch (error) {
        console.error("Gemini ë¶„ì„ ì—ëŸ¬:", error);
        alert("ìŒì‹ ì¢…ë¥˜ ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
      }
    }
  });
</script>